---
layout: page
title: "Parsers"
category: dev
date: 2016-02-17
order: 1
---

Current implementations of parsers include:
  * [Protocol Buffers](https://developers.google.com/protocol-buffers/)
  * [Json](http://json.org/)
  * [Reflected structures in Go](http://golang.org/pkg/reflect)
  * XML for the dinosaurs and dragons amongst us.

Implementing a Parser for a new serialization format or any other parsable text or bytes can be done by implementing the following interface.

{% highlight go %}
type Parser interface {
    Next() error
    IsLeaf() bool
    Up()
    Down()
    Decoder
}

type Decoder interface {
    Double() (float64, error)
    Int() (int64, error)
    Uint() (uint64, error)
    Bool() (bool, error)
    String() (string, error)
    Bytes() ([]byte, error)
}
{% endhighlight %}

This allows for the implementation of a streaming parser.
A parser that lazily parses the input as the methods are called and only parses the input once, without backtracking.
Exercising the Parser can be done with the [debug.Walk](https://godoc.org/github.com/katydid/katydid/serialize/debug#Walk) function.  The Walk function also returns some debugging output which should be useful in the development of your Parser.

Here is a simpler, but similar walk function, just to give an idea of the way your Parser will be used.
{% highlight go %}
func walk(parser serialize.Parser) {
    for {
        if err := parser.Next(); err != nil {
            if err == io.EOF {
                break
            } else {
                panic(err)
            }
        }
        value := print(parser.(serialize.Decoder))
        if !parser.IsLeaf() {
            parser.Down()
            walk(parser)
            parser.Up()
        }
    }
    return
}
{% endhighlight %}

Your parser should also be able to handle skipping of some of the input.  This happens when the Walk function returns before encountering an io.EOF.  The [debug.RandomWalk](https://godoc.org/github.com/katydid/katydid/serialize/debug#RandomWalk) function is useful for testing this the robustness of your Parser.
